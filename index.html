<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ElectroMart â€” Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
  <meta name="description" content="Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…ØµÙ…Ù… Ø¨Ù€ HTML, CSS, JavaScript â€” ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·ÙˆÙŠØ±." />
  <style>
    :root{
      --bg:#0f1724; /* dark navy */
      --card:#0b1720;
      --muted:#94a3b8;
      --accent:#06b6d4; /* teal */
      --accent-2:#7c3aed; /* purple */
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      --radius:14px;
      --maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(180deg,var(--bg),#071021 120%);color:#e6eef6}
    a{color:inherit;text-decoration:none}
    .container{width:95%;max-width:var(--maxw);margin:28px auto}

    /* header */
    header{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:700;color:#021018}
    .brand h1{font-size:18px;margin:0}
    .brand p{margin:0;color:var(--muted);font-size:12px}

    /* search & actions */
    .controls{display:flex;gap:12px;align-items:center}
    .search{background:var(--glass);padding:8px 12px;border-radius:12px;display:flex;align-items:center;gap:8px;min-width:260px}
    .search input{background:transparent;border:0;color:inherit;outline:none;font-size:14px}
    .icon-btn{background:var(--glass);padding:10px 12px;border-radius:12px;display:inline-grid;place-items:center;cursor:pointer}

    /* layout */
    main{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px}
    @media(max-width:980px){main{grid-template-columns:1fr} .sidebar{order:2}}

    /* product grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media(max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:680px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,var(--card),#06101a);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:12px}
    .thumb{height:160px;border-radius:10px;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));display:grid;place-items:center;position:relative;overflow:hidden}
    .thumb img{max-width:100%;max-height:100%;object-fit:contain}
    .meta{display:flex;align-items:center;justify-content:space-between}
    .title{font-weight:600}
    .price{font-weight:700;color:var(--accent)}
    .rating{color:var(--muted);font-size:13px}
    .badge{padding:6px 8px;border-radius:8px;background:linear-gradient(90deg, rgba(7,116,117,0.12), rgba(124,58,237,0.06));font-size:12px}

    .actions{display:flex;gap:8px}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:10px 12px;border-radius:10px;border:0;color:#021018;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    /* sidebar cart */
    .sidebar{position:sticky;top:28px}
    .panel{background:var(--glass);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .cart-items{display:flex;flex-direction:column;gap:10px;max-height:360px;overflow:auto;padding-right:6px}
    .cart-item{display:flex;gap:10px;align-items:center}
    .cart-item img{width:56px;height:56px;border-radius:8px;object-fit:contain}
    .qty{display:flex;align-items:center;gap:6px}
    .small{font-size:13px;color:var(--muted)}

    /* filters */
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 10px;border-radius:999px;background:var(--glass-2);border:1px solid rgba(255,255,255,0.02);cursor:pointer;font-size:13px}
    .chip.active{background:linear-gradient(90deg, rgba(6,182,212,0.12), rgba(124,58,237,0.06));border:1px solid rgba(124,58,237,0.14)}

    /* product modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(1,6,10,0.5), rgba(1,6,10,0.6));z-index:60;padding:20px}
    .modal.open{display:flex}
    .modal-card{width:min(920px,98%);background:linear-gradient(180deg,#071426,#08121a);border-radius:16px;padding:18px;border:1px solid rgba(255,255,255,0.04);display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:900px){.modal-card{grid-template-columns:1fr} .modal-card .details{order:2}}

    /* footer */
    footer{text-align:center;color:var(--muted);margin:28px 0}

    /* empty state */
    .empty{padding:40px;border-radius:12px;text-align:center;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px dashed rgba(255,255,255,0.02)}

    /* tiny helpers */
    .muted{color:var(--muted)}
    .flex{display:flex;align-items:center}
    .gap-8{gap:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">EM</div>
        <div>
          <h1>ElectroMart</h1>
          <p>Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ø§Ø­ØªØ±Ø§ÙÙŠ â€” ØªØµÙ…ÙŠÙ… Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·ÙˆÙŠØ±</p>
        </div>
      </div>

      <div class="controls">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‡Ø§ØªÙØŒ Ù„Ø§Ø¨ØªÙˆØ¨ØŒ Ù…Ù„Ø­Ù‚Ø§Øª..." />
        </div>
        <div class="icon-btn" id="favoritesBtn" title="Ø§Ù„Ù…ÙØ¶Ù„Ø©">
          â¤
        </div>
        <div class="icon-btn" id="cartToggle" title="Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚">
          ğŸ›’ <span id="cartCount" style="margin-inline-start:6px;font-weight:700">0</span>
        </div>
      </div>
    </header>

    <main>
      <section>
        <div class="panel" style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Ø¹Ø±Ø¶</div>
            <h2 style="margin:0">Ø£ÙØ¶Ù„ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</h2>
            <div class="muted" style="font-size:13px;margin-top:6px">Ø´Ø¨ÙƒØ© Ù…Ù†ØªØ¬Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ø­Ù„ÙŠØ©</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="filters" id="categoryFilters">
              <!-- chips injected -->
            </div>
          </div>
        </div>

        <div id="productsGrid" class="grid">
          <!-- Ù…Ù†ØªØ¬Ø§Øª ØªÙØ­Ù‚Ù† Ù‡Ù†Ø§ Ø¨Ù€ JavaScript -->
        </div>

        <div id="emptyState" class="empty" style="display:none;margin-top:14px">
          <strong>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</strong>
          <p class="muted">Ø¬Ø±Ù‘Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ ØªÙØ±ÙŠØº Ø§Ù„ÙÙ„Ø§ØªØ±.</p>
        </div>
      </section>

      <aside class="sidebar">
        <div class="panel">
          <h3 style="margin:0 0 8px 0">Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
          <div id="cartItems" class="cart-items">
            <div class="muted">Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª</div>
          </div>

          <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</div>
              <div id="cartTotal" style="font-size:18px;font-weight:800">$0.00</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn" id="checkoutBtn">Ø§Ù„Ø¯ÙØ¹</button>
              <button class="btn ghost" id="clearCartBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
            </div>
          </div>
        </div>

        <div style="height:18px"></div>

        <div class="panel">
          <h4 style="margin:0 0 8px 0">Ø¹Ø±ÙˆØ¶ Ø³Ø±ÙŠØ¹Ø©</h4>
          <div class="small muted">ØªØ®ÙÙŠØ¶Ø§Øª Ø­ØªÙ‰ 30% Ø¹Ù„Ù‰ Ø³Ù…Ø§Ø¹Ø§Øª Ù…Ø­Ø¯Ø¯Ø©. Ø§Ø´ØªØ±Ùƒ Ù„Ù„Ù†Ø´Ø±Ø©.</div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <input id="newsletterEmail" placeholder="Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="flex:1;padding:10px;border-radius:10px;border:0;background:transparent;color:inherit;outline:none" />
            <button class="btn" onclick="subscribe()">Ø§Ø´ØªØ±Ùƒ</button>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <div class="muted">Â© ElectroMart 2025 â€” ØªØµÙ…ÙŠÙ… ÙˆØªØ¬Ø±Ø¨Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</div>
    </footer>
  </div>

  <!-- Modal product detail -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="thumb" style="background:transparent;padding:18px">
        <img id="modalImg" src="" alt="">
      </div>
      <div class="details">
        <h2 id="modalTitle"></h2>
        <div class="small muted" id="modalCategory"></div>
        <p id="modalDesc" class="muted" style="margin-top:8px"></p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:10px">
          <div style="font-weight:800;font-size:20px;color:var(--accent)" id="modalPrice">$0</div>
          <div class="badge" id="modalBadge" style="display:none">Ø¹Ø±Ø¶</div>
        </div>
        <div style="margin-top:14px;display:flex;gap:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <label class="small muted">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
            <input id="modalQty" type="number" min="1" value="1" style="width:68px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" />
          </div>
        </div>
        <div style="margin-top:16px;display:flex;gap:8px">
          <button class="btn" id="addToCartModal">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
          <button class="btn ghost" id="closeModal">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ======
    const PRODUCTS = [
      {id:1,title:'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ X1',price:799.00,category:'Ù‡ÙˆØ§ØªÙ',rating:4.6,stock:12,desc:'Ù‡Ø§ØªÙ Ø¨Ù…ÙˆØ§ØµÙØ§Øª Ø¹Ø§Ù„ÙŠØ©ØŒ Ø´Ø§Ø´Ø© OLED ÙˆÙƒØ§Ù…ÙŠØ±Ø§ 50MP.',img:'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?auto=format&fit=crop&w=800&q=60'},
      {id:2,title:'Ø§Ø¨ØªÙˆØ¨ Pro 14',price:1299.00,category:'Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª',rating:4.8,stock:6,desc:'Ù…Ø¹Ø§Ù„Ø¬ Ù‚ÙˆÙŠØŒ Ø°Ø§ÙƒØ±Ø© 16GBØŒ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©.',img:'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=800&q=60'},
      {id:3,title:'Ø³Ù…Ø§Ø¹Ø§Øª Ø³Ù„ÙƒÙŠØ© Beat',price:59.99,category:'Ø³Ù…Ø§Ø¹Ø§Øª',rating:4.2,stock:30,desc:'ØµÙˆØª ÙˆØ§Ø¶Ø­ØŒ ØªØµÙ…ÙŠÙ… Ù…Ø±ÙŠØ­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·ÙˆÙŠÙ„.',img:'https://images.unsplash.com/photo-1518444024820-83d7b10d8c4b?auto=format&fit=crop&w=800&q=60'},
      {id:4,title:'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ« AirGo',price:149.00,category:'Ø³Ù…Ø§Ø¹Ø§Øª',rating:4.5,stock:18,desc:'ÙˆØ§ÙŠØ±Ù„ÙŠØ³ØŒ Ø¹Ù…Ø± Ø¨Ø·Ø§Ø±ÙŠØ© Ø·ÙˆÙŠÙ„ØŒ Ø¹Ø²Ù„ Ù…Ù†Ø§Ø³Ø¨.',img:'https://images.unsplash.com/photo-1587574293344-4b5f4d3d2e7b?auto=format&fit=crop&w=800&q=60'},
      {id:5,title:'Ø´Ø§Ø­Ù† Ø³Ø±ÙŠØ¹ 65W',price:39.50,category:'Ù…Ù„Ø­Ù‚Ø§Øª',rating:4.1,stock:45,desc:'Ø´Ø§Ø­Ù† Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§ÙØ° ÙŠØ¯Ø¹Ù… Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø³Ø±ÙŠØ¹.',img:'https://images.unsplash.com/photo-1606813903836-6d6b0b0c7d34?auto=format&fit=crop&w=800&q=60'},
      {id:6,title:'ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙŠØ¨ HD',price:89.00,category:'ÙƒØ§Ù…ÙŠØ±Ø§Øª',rating:4.0,stock:10,desc:'ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ù„Ø¨Ø« ÙˆØ§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.',img:'https://images.unsplash.com/photo-1588702547923-7093a6c3ba33?auto=format&fit=crop&w=800&q=60'},
      {id:7,title:'ØªØ§Ø¨Ù„Øª M8',price:399.00,category:'ØªØ§Ø¨Ù„Øª',rating:4.3,stock:9,desc:'ØªØ§Ø¨Ù„Øª Ø®ÙÙŠÙ Ù„Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØªØ±ÙÙŠÙ‡.',img:'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=800&q=60'},
      {id:8,title:'Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø¨Ø« Studio',price:129.00,category:'Ù…Ù„Ø­Ù‚Ø§Øª',rating:4.7,stock:5,desc:'Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„Ø¨ÙˆØ¯ÙƒØ§Ø³Øª ÙˆØ§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.',img:'https://images.unsplash.com/photo-1515879218367-8466d910aaa4?auto=format&fit=crop&w=800&q=60'}
    ];

    // ====== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø©) ======
    let state = {
      products: PRODUCTS,
      query: '',
      activeCategory: 'ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª',
      cart: JSON.parse(localStorage.getItem('em_cart')||'[]')
    };

    // ====== Ø¹Ù†Ø§ØµØ± DOM ======
    const productsGrid = document.getElementById('productsGrid');
    const searchInput = document.getElementById('searchInput');
    const categoryFilters = document.getElementById('categoryFilters');
    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartCountEl = document.getElementById('cartCount');
    const emptyState = document.getElementById('emptyState');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalPrice = document.getElementById('modalPrice');
    const modalCategory = document.getElementById('modalCategory');
    const modalBadge = document.getElementById('modalBadge');
    const modalQty = document.getElementById('modalQty');
    const addToCartModal = document.getElementById('addToCartModal');
    const closeModal = document.getElementById('closeModal');

    // ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ± ======
    function renderCategoryChips(){
      const cats = ['ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª', ...new Set(state.products.map(p=>p.category))];
      categoryFilters.innerHTML = '';
      cats.forEach(c=>{
        const btn = document.createElement('button');
        btn.className = 'chip'+(state.activeCategory===c? ' active':'');
        btn.textContent = c;
        btn.onclick = ()=>{state.activeCategory=c; render();}
        categoryFilters.appendChild(btn);
      })
    }

    // ====== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«/ÙÙ„ØªØ±Ø© ======
    function filteredProducts(){
      return state.products.filter(p=>{
        const matchesQuery = state.query.trim()==='' || p.title.toLowerCase().includes(state.query.toLowerCase()) || p.desc.toLowerCase().includes(state.query.toLowerCase());
        const matchesCat = state.activeCategory==='ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª' || p.category===state.activeCategory;
        return matchesQuery && matchesCat;
      })
    }

    function renderProducts(){
      const list = filteredProducts();
      productsGrid.innerHTML = '';
      if(list.length===0){ emptyState.style.display='block'; return } else { emptyState.style.display='none' }
      list.forEach(p=>{
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <div class="thumb"><img src="${p.img}" alt="${p.title}"></div>
          <div class="meta"><div><div class="title">${p.title}</div><div class="small muted">${p.category} â€¢ â­ ${p.rating}</div></div><div class="price">$${p.price.toFixed(2)}</div></div>
          <div class="small muted">${p.desc}</div>
          <div class="actions">
            <button class="btn" data-id="${p.id}">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
            <button class="btn ghost" data-view="${p.id}">Ø¹Ø±Ø¶</button>
          </div>
        `;
        productsGrid.appendChild(card);
      })
    }

    // ====== Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ======
    function saveCart(){ localStorage.setItem('em_cart', JSON.stringify(state.cart)); }
    function addToCart(productId, qty=1){
      const existing = state.cart.find(i=>i.id===productId);
      if(existing){ existing.qty += qty; } else { const p = state.products.find(x=>x.id===productId); state.cart.push({id:p.id,title:p.title,price:p.price,img:p.img,qty}); }
      saveCart(); renderCart();
    }
    function removeFromCart(productId){ state.cart = state.cart.filter(i=>i.id!==productId); saveCart(); renderCart(); }
    function changeQty(productId, qty){ const it = state.cart.find(i=>i.id===productId); if(!it) return; it.qty = Math.max(1, qty); saveCart(); renderCart(); }
    function clearCart(){ state.cart = []; saveCart(); renderCart(); }

    function renderCart(){
      cartItemsEl.innerHTML = '';
      if(state.cart.length===0){ cartItemsEl.innerHTML = '<div class="muted">Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª</div>'; cartTotalEl.textContent = '$0.00'; cartCountEl.textContent = '0'; return }
      let total=0, count=0;
      state.cart.forEach(item=>{
        total += item.price * item.qty; count += item.qty;
        const row = document.createElement('div'); row.className='cart-item';
        row.innerHTML = `
          <img src="${item.img}" alt="${item.title}" />
          <div style="flex:1"><div style="font-weight:700">${item.title}</div><div class="small muted">$${item.price.toFixed(2)}</div></div>
          <div class="qty">
            <button class="chip" data-decr="${item.id}">-</button>
            <div style="min-width:28px;text-align:center">${item.qty}</div>
            <button class="chip" data-incr="${item.id}">+</button>
            <button class="chip" data-rem="${item.id}" title="Ø¥Ø²Ø§Ù„Ø©">âœ•</button>
          </div>
        `;
        cartItemsEl.appendChild(row);
      })
      cartTotalEl.textContent = '$' + total.toFixed(2);
      cartCountEl.textContent = count;
    }

    // ====== Modal ======
    let currentModalProduct = null;
    function openModal(productId){
      const p = state.products.find(x=>x.id===productId); if(!p) return;
      currentModalProduct = p;
      modalImg.src = p.img; modalTitle.textContent = p.title; modalDesc.textContent = p.desc; modalPrice.textContent = '$' + p.price.toFixed(2); modalCategory.textContent = p.category;
      modalBadge.style.display = p.stock>10? 'inline-block':'none';
      modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
      modalQty.value = 1;
    }
    function closeModalFn(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); currentModalProduct = null }

    // ====== Ø­Ø¯Ø«ÙŠØ§Øª ÙˆØªÙ‡ÙŠØ¦Ø© ======
    function attachHandlers(){
      // Ø¨Ø­Ø«
      searchInput.addEventListener('input', (e)=>{ state.query = e.target.value; render(); });

      // Ø§Ø³ØªÙ…Ø·Ø§Ø± Ú©Ù„ÛŒÚ©ÛŒ Ù„Ù…Ù†ØªØ¬Ø§Øª
      productsGrid.addEventListener('click', (e)=>{
        if(e.target.matches('button[data-id]')){
          const id = Number(e.target.getAttribute('data-id')); addToCart(id,1);
          e.target.textContent = 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ“'; setTimeout(()=>e.target.textContent='Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©',900);
        }
        if(e.target.matches('button[data-view]')){
          const id = Number(e.target.getAttribute('data-view')); openModal(id);
        }
      });

      // Ø³Ù„Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      cartItemsEl.addEventListener('click',(e)=>{
        const decr = e.target.getAttribute('data-decr'); const incr = e.target.getAttribute('data-incr'); const rem = e.target.getAttribute('data-rem');
        if(decr) changeQty(Number(decr), Math.max(1, (state.cart.find(i=>i.id===Number(decr))||{qty:1}).qty - 1));
        if(incr) changeQty(Number(incr), (state.cart.find(i=>i.id===Number(incr))||{qty:0}).qty + 1);
        if(rem) removeFromCart(Number(rem));
      });

      // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
      addToCartModal.addEventListener('click', ()=>{ if(!currentModalProduct) return; addToCart(currentModalProduct.id, Number(modalQty.value)||1); closeModalFn(); });
      closeModal.addEventListener('click', closeModalFn);
      modal.addEventListener('click',(e)=>{ if(e.target===modal) closeModalFn(); });

      // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
      document.getElementById('checkoutBtn').addEventListener('click', ()=>{ alert('Ù†Ù…ÙˆØ°Ø¬ Ø¯ÙØ¹ ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡ ØºÙŠØ± Ù…ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©.'); });
      document.getElementById('clearCartBtn').addEventListener('click', ()=>{ if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ø±Ø¨Ø©ØŸ')) clearCart(); });

      // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
      window.subscribe = function(){ const email = document.getElementById('newsletterEmail').value; if(!email.includes('@')){ alert('Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ù‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§'); return } alert('Ø´ÙƒØ±Ù‹Ø§ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ â€” Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©'); document.getElementById('newsletterEmail').value=''; }

      // ØªÙØ¹ÙŠÙ„ ÙØªØ­/ØºÙ„Ù‚ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨Ø©
      document.getElementById('cartToggle').addEventListener('click', ()=>{
        window.scrollTo({top:0,behavior:'smooth'});
        const sidebar = document.querySelector('.sidebar'); sidebar.classList.toggle('open'); sidebar.style.boxShadow = sidebar.classList.contains('open')? '0 10px 30px rgba(0,0,0,0.5)':'';
      });

      // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      window.addEventListener('beforeunload', saveCart);

      // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© (ØªØ¬Ø±ÙŠØ¨ÙŠ)
      document.getElementById('favoritesBtn').addEventListener('click', ()=>{ alert('Ù…ÙŠØ²Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ØºÙŠØ± Ù…ÙØ¹Ù„Ø© Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©'); });
    }

    function render(){ renderCategoryChips(); renderProducts(); renderCart(); }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    attachHandlers(); render();

  </script>
</body>
</html>
